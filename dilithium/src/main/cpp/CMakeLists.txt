cmake_minimum_required(VERSION 3.6.0)

project("godilithium")
add_link_options(-Wl,-z,max-page-size=16384)
# Define the path to place generated Java sources
set(JAVA_MODULE_PATH com/silencelaboratories/godilithium)
set(GENERATED_SOURCES_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../java/${JAVA_MODULE_PATH})

# Make sure SWIG is found and included
find_package(SWIG REQUIRED)
include(UseSWIG)

# Include directories
include_directories(${CMAKE_CURRENT_SOURCE_DIR})

# SWIG configuration, Interface file is not autogenerated.
set(SWIG_INTERFACE interface_file.i)
set(CMAKE_SWIG_FLAGS -package com.silencelaboratories.godilithium)

# Set output directories for SWIG
set(SWIG_WRAPPER_DIR ${CMAKE_CURRENT_SOURCE_DIR})
set(SWIG_OUTPUT_DIR ${GENERATED_SOURCES_DIR})

file(MAKE_DIRECTORY ${SWIG_WRAPPER_DIR})
file(MAKE_DIRECTORY ${SWIG_OUTPUT_DIR})

set_property(SOURCE interface_file.i PROPERTY SWIG_MODULE_NAME godilithiumswig)

#import original libvscore
add_library(libvscore STATIC IMPORTED)
set_target_properties(libvscore
        PROPERTIES IMPORTED_LOCATION
        ${CMAKE_CURRENT_SOURCE_DIR}/libs/${ANDROID_ABI}/libvscore.so)

add_library(dilithium_buffer_util SHARED buffer_util.c)
#create swig wrapper
swig_add_library(
        godilithiumswig
        LANGUAGE java
        SOURCES ${SWIG_INTERFACE}
        OUTFILE_DIR ${SWIG_WRAPPER_DIR}
        OUTPUT_DIR ${SWIG_OUTPUT_DIR}
)

#link libvscore to swig
target_link_libraries(godilithiumswig libvscore dilithium_buffer_util ${log-lib})
