cmake_minimum_required(VERSION 3.6.0)

project("goschnorr")

# Define the path to place generated Java sources
set(JAVA_MODULE_PATH com/silencelaboratories/goschnorr)
set(GENERATED_SOURCES_DIR ${CMAKE_CURRENT_SOURCE_DIR}/source/${JAVA_MODULE_PATH})

# Make sure SWIG is found and included
find_package(SWIG REQUIRED)
include(UseSWIG)

# Include directories
include_directories(${CMAKE_CURRENT_SOURCE_DIR})

# SWIG configuration, Interface file is not autogenerated.
set(SWIG_INTERFACE interface_file.i)
set(CMAKE_SWIG_FLAGS -package com.silencelaboratories.goschnorr)

# Set output directories for SWIG
set(SWIG_WRAPPER_DIR ${CMAKE_CURRENT_SOURCE_DIR}/source/cpp)
set(SWIG_OUTPUT_DIR ${GENERATED_SOURCES_DIR})

file(MAKE_DIRECTORY ${SWIG_WRAPPER_DIR})
file(MAKE_DIRECTORY ${SWIG_OUTPUT_DIR})

set_property(SOURCE interface_file.i PROPERTY SWIG_MODULE_NAME goschnorrswig)

#import original libgoschnorr
add_library(libgoschnorr STATIC IMPORTED)
set_target_properties(libgoschnorr
        PROPERTIES IMPORTED_LOCATION
        ${CMAKE_CURRENT_SOURCE_DIR}/libs/${ANDROID_ABI}/libgoschnorr.so)

#create swig wrapper
swig_add_library(
        goschnorrswig
        LANGUAGE java
        SOURCES ${SWIG_INTERFACE}
        OUTFILE_DIR ${SWIG_WRAPPER_DIR}
        OUTPUT_DIR ${SWIG_OUTPUT_DIR}
)

#link libgoschnorr to swig
target_link_libraries(goschnorrswig libgoschnorr ${log-lib})